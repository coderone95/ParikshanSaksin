function formatDate(t){var e=t.getDate(),o=t.getMonth();return t.getFullYear()+"-"+o+"-"+e}function toggleSwitch(t){var e=$(".update-question-field");"off"==t?$(e).each(function(t){$(this).removeAttr("disabled")}):$(e).each(function(t){$(this).attr("disabled","true")})}$(document).ready(function(){addOption("option-area","y"),$(".datepicker").datepicker({format:"yyyy-mm-dd",todayHighlight:!0,language:"en",clearBtn:!0,autoclose:!0}),$(".datepicker").datepicker("setDate",new Date),applyQuestionsFilter("ON_LOAD"),$("#addQueBtn").on("click",function(){var t=[],e=$("#question").val(),o=$("#correctOption").val(),n={},a=0;$(".option").each(function(){t.push($(this).val()),n[a++]=$(this).val()});var i={question:e,optionList:t,correctOption:o,myoptions:n};$.ajax({type:"POST",url:"addQuestion",data:JSON.stringify(i),dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){null!=t.successMessageList&&t.successMessageList.length>0?(alert("Question added successfully"),applyQuestionsFilter("ON_LOAD")):null!=t.errorMsg&&""!=t.errorMsg&&alert(t.errorMsg)}})}),$(".option").on("keyup blur",function(){selectCorrectOption()}),$("#searchQuestion").on("keyup keydown",function(){var t={searchKey:$(this).val()};$.ajax({type:"POST",url:"getSearchedQuestion",data:JSON.stringify(t),dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){}})}),$(".custom-switch").on("click",function(){$(this).hasClass("fa-toggle-on")?($(this).removeClass("fa-toggle-on"),$(this).addClass("fa-toggle-off"),toggleSwitch("on")):$(this).hasClass("fa-toggle-off")&&($(this).removeClass("fa-toggle-off"),$(this).addClass("fa-toggle-on"),toggleSwitch("off"))})});var count=1;function updateQuestion(t){localStorage.removeItem("selelctedQuestionID"),localStorage.setItem("selelctedQuestionID",t),updateQestionDetails(t),$("#updateQuestionModal").modal("show")}function updateQestionDetails(t){$("#updateOptions").html(""),$("#updateCorrectOption").html("");var e={quesID:t};$.ajax({type:"POST",url:"getQuestionDetails",dataType:"json",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",success:function(t){if(null!=t.questionDetail){$("#updateQuestion_name").val(t.questionDetail.question);var e="",o="",n=65;for(var a in t.questionDetail.optionsMap){if(t.questionDetail.optionsMap.hasOwnProperty(a)){var i=t.questionDetail.optionsMap[a];e+='<li value="'+a+'"><input type="text" style="padding:0.4rem; " class="option-item update-question-field" value="'+i+'" disabled /></li><br>',t.questionDetail.answer==i?o+='<option value="'+a+'" '+"selected"+"> &#"+n+";</option>":o+='<option value="'+a+'"> &#'+n+";</option>"}n++}$("#updateOptions").append(e),$("#updateCorrectOption").append(o)}},error:function(t){alert("Error occurred while getting question details..!!")}})}function updateQue(){if($(".custom-switch").hasClass("fa-toggle-on")){var t=localStorage.getItem("selelctedQuestionID"),e=$("#updateQuestion_name").val(),o=$(".option-item"),n={},a=$("#updateCorrectOption").val();$(o).each(function(){n[$(this).parent().attr("value")]=$(this).val()}),console.log(n);var i={selelctedQuestionID:t,selectedCorrectOption:a,optionMap:n,questionValue:e};$.ajax({type:"POST",url:"updateQuestionDetails",dataType:"json",data:JSON.stringify(i),contentType:"application/json;charset=utf-8",success:function(t){alert("Question Updated successfully!!"),$("#updateQuestionModal").modal("hide"),applyQuestionsFilter("ON_LOAD")},error:function(t){alert("Error occurred while getting question details..!!")}})}else alert("Enable editing mode!!")}function showQuestionDetails(t){getQuestionDetails(t),$("#showQuestionDetailsModal").modal("show")}function getQuestionDetails(t){$("#optionList").html(""),$("#answer").html(""),$("#questionName").text("");var e={quesID:t};$.ajax({type:"POST",url:"getQuestionDetails",dataType:"json",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",success:function(t){if(403==t.re.status&&null!=t.re)alert("Unable to fetch question details");else if(null!=t.questionDetail){$("#questionName").text(t.questionDetail.question);for(var e="",o=65,n=0;n<t.questionDetail.options.length;n++)t.questionDetail.answer==t.questionDetail.options[n]&&(ans=o),e+="<li>"+t.questionDetail.options[n]+"</li>",o++;$("#optionList").append(e),$("#answer").append("Answer: &#"+ans+";")}},error:function(t){alert("Error occurred while getting question details..!!")}})}function deleteThis(t){$("#deleteModal").modal("show"),$("#deleteBtn").removeAttr("onclick"),$("#deleteBtn").attr("onclick","deleteQuestion("+t+");")}function deleteQuestion(t){var e={queID:t};$.ajax({type:"POST",url:"deleteQuestion",data:JSON.stringify(e),dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){alert("Question deleted"),$("#deleteModal").modal("hide"),applyQuestionsFilter("ON_LOAD")},error:function(t){alert("Error while processing the request....!!")}})}function addOption(t,e){var o=$("#"+t),n=count++;str='<div id="option-div-'+n+'"><label>Option</label><div class="row"><div class="col-md-8"><textarea class="form-control option"  rows="1" ></textarea></div><div class="col-md-4"><a href="#" onclick="deleteOption(\''+n+'\');" style="color:red"><i class="fa fa-trash-o fa-lg delete-option-icon"></i></a></div></div></div>',$(o).append(str),"y"==e&&selectCorrectOption()}function deleteOption(t){1==$(".delete-option-icon").length?alert("At least one option must be available"):($("#option-div-"+t).remove(),count--,selectCorrectOption())}function selectCorrectOption(){$("#correctOption").html("");var t="",e=0;$(".option").each(function(){t+='<option value="'+e+'">Option '+(e+1)+"</option>",e++}),$("#correctOption").append(t)}function applyQuestionsFilter(t){var e="",o="";"ON_LOAD"==t?(e="",o=""):(""!=$("#startDate").val()&&(e=$("#startDate").val()+" 00:00:00"),""!=$("#endDate").val()&&(o=$("#endDate").val()+" 23:59:00")),$(".questions-table-loader").show(),$("#questions-table-body").html("");var n={startDate:e,endDate:o,questionName:$("#byQuestionName").val(),questionId:+$("#byQuestionId").val(),createdBy:$("#createdBy").val()};$.ajax({type:"POST",url:"getQuestionReport",data:JSON.stringify(n),dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){var e="";if(null!=t.questionInfo&&t.questionInfo.length>0){for(var o=0;o<t.questionInfo.length;o++){var n=t.questionInfo[o].question_id,a=t.questionInfo[o].question;t.questionInfo[o].answer;e+='<tr><th scope="row"><a href="#" onclick="showQuestionDetails('+n+');">'+n+"</a></th><td>"+a+"</td><td>"+t.questionInfo[o].question_createdBy+"</td><td>"+t.questionInfo[o].question_updatedBy+'</td><td><i class="fa fa-trash delete text-danger" onclick="deleteThis('+n+');"></i><i class="fa fa-pencil edit text-primary" onclick="updateQuestion('+n+');"></i></td></tr>'}$("#questions-table-body").append(e),$(".questions-table-loader").hide()}else e+='<tr><td colspan="6"><div class="text-center"> No record found </div></td></tr>',$("#questions-table-body").append(e),$(".questions-table-loader").hide()},error:function(t){alert("Error while processing the request....!!")}}),$("#questionFilterModal").modal("hide")}